<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth0 on Google Cloud Platform with Python | Deepak Kumar Yadav</title>
    <link rel="stylesheet" href="../../css/styles.css">
    <link rel="stylesheet" href="../../css/blog-post.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pyodide@0.24.1/pyodide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        .code-block { background: #f8f9fa; border-radius: 8px; padding: 1rem; margin: 1.5rem 0; overflow-x: auto; }
        pre { margin: 0; }
        .info-box { background: #e3f2fd; border-left: 5px solid #1976d2; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 8px; }
        .warning-box { background: #fff3cd; border-left: 5px solid #ffc107; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 8px; }
        .success-box { background: #d4edda; border-left: 5px solid #28a745; padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 8px; }
        .checklist { background: #f8f9fa; border-radius: 10px; padding: 2rem; margin: 2rem 0; }
        .checklist ul { list-style: none; padding: 0; }
        .checklist li { margin: 0.5rem 0; padding: 0.5rem; background: white; border-radius: 5px; border-left: 4px solid #28a745; }
        
        .interactive-code { 
            background: #f8f9fa; 
            border-radius: 10px; 
            padding: 1.5rem; 
            margin: 2rem 0; 
            border: 2px solid #007bff;
        }
        .interactive-code h4 {
            margin-top: 0;
            color: #007bff;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .code-editor {
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 1rem 0;
        }
        .run-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem 0;
        }
        .run-button:hover {
            background: #218838;
        }
        .run-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
        }
        .loading {
            color: #ffc107;
        }
        .error {
            color: #dc3545;
        }
        .success {
            color: #28a745;
        }
        .architecture-diagram {
            background: #ffffff;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
        }
        .best-practices {
            background: #f1f8ff;
            border: 1px solid #c0d4ed;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
        }
        .best-practices h4 {
            color: #0366d6;
            margin-top: 0;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .comparison-table th,
        .comparison-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .comparison-table th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
        .comparison-table tr:hover {
            background-color: #f5f5f5;
        }
        .auth-flow-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        .flow-step {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
        }
        .flow-step h4 {
            margin: 0 0 1rem 0;
            font-size: 1.2rem;
        }
        .flow-step p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="nav-brand">
                <a href="../../index.html">Deepak Kumar Yadav</a>
            </div>
            <ul>
                <li><a href="../../blog.html">Blog</a></li>
                <li><a href="../../index.html#contact">Contact</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <article class="blog-post-content">
            <header class="post-header">
                <h1>üîë Auth0 : GCP & Python</h1>
            </header>

            <section class="post-content">
                <h2>What is Auth0?</h2>
                <div class="info-box">
                    <p>
                        <strong>Auth0</strong> is a cloud-based identity and access management (IAM) platform that provides authentication and authorization as a service. It acts as an identity provider (IdP) that handles user authentication, authorization, and management, allowing developers to focus on building their applications rather than implementing complex security protocols.
                    </p>
                    <ul>
                        <li><strong>Authentication:</strong> Verifies user identity through multiple methods (username/password, social logins, MFA, biometrics)</li>
                        <li><strong>Authorization:</strong> Controls access to resources using role-based access control (RBAC), attribute-based access control (ABAC)</li>
                        <li><strong>User Management:</strong> Centralized user profiles, metadata, and lifecycle management</li>
                        <li><strong>Security:</strong> Built-in protection against attacks like brute force, credential stuffing, and anomaly detection</li>
                        <li><strong>Compliance:</strong> Meets industry standards (GDPR, SOC2, HIPAA, PCI DSS, ISO 27001)</li>
                        <li><strong>Scalability:</strong> Handles millions of users with 99.99% uptime SLA</li>
                    </ul>
                </div>

                <h2>Auth0 Architecture Overview</h2>
                <div class="architecture-diagram">
                    <div class="mermaid">
                        graph TD
                            A[User] -->|1. Access App| B[Python App on GCP]
                            B -->|2. Redirect to Auth0| C[Auth0 Universal Login]
                            C -->|3. Authenticate| D[Identity Providers]
                            D -->|4. Return Token| C
                            C -->|5. Callback with Code| B
                            B -->|6. Exchange Code for Token| E[Auth0 Token Endpoint]
                            E -->|7. Return JWT/Access Token| B
                            B -->|8. Access Protected Resources| F[GCP Services]
                            
                            D --> D1[Username/Password]
                            D --> D2[Google/Facebook/GitHub]
                            D --> D3[SAML/Active Directory]
                            D --> D4[MFA/Biometrics]
                            
                            F --> F1[Cloud Run]
                            F --> F2[Cloud Functions]
                            F --> F3[Firestore]
                            F --> F4[Cloud Storage]
                            
                            style A fill:#e1f5fe
                            style B fill:#f3e5f5
                            style C fill:#fff3e0
                            style E fill:#e8f5e8
                    </div>
                </div>

                <h2>Authentication Flow Deep Dive</h2>
                <div class="auth-flow-steps">
                    <div class="flow-step">
                        <h4>1. üöÄ Initial Request</h4>
                        <p>User attempts to access a protected resource in your Python application</p>
                    </div>
                    <div class="flow-step">
                        <h4>2. üîÑ Auth0 Redirect</h4>
                        <p>App redirects user to Auth0's Universal Login page with client_id and redirect_uri</p>
                    </div>
                    <div class="flow-step">
                        <h4>3. üîê User Authentication</h4>
                        <p>User authenticates using chosen method (password, social login, MFA, etc.)</p>
                    </div>
                    <div class="flow-step">
                        <h4>4. üé´ Authorization Code</h4>
                        <p>Auth0 redirects back to your app with an authorization code</p>
                    </div>
                    <div class="flow-step">
                        <h4>5. üîë Token Exchange</h4>
                        <p>Your app exchanges the code for access tokens and ID tokens</p>
                    </div>
                    <div class="flow-step">
                        <h4>6. ‚úÖ Access Granted</h4>
                        <p>User can now access protected resources with valid JWT tokens</p>
                    </div>
                </div>

                <h2>Why Use Auth0 with Google Cloud Platform?</h2>
                
                <h3>üèÜ Key Benefits</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>Traditional Auth</th>
                            <th>Auth0 + GCP</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Development Time</strong></td>
                            <td>Weeks/Months</td>
                            <td>Hours/Days</td>
                        </tr>
                        <tr>
                            <td><strong>Security Updates</strong></td>
                            <td>Manual maintenance</td>
                            <td>Automated by Auth0</td>
                        </tr>
                        <tr>
                            <td><strong>Compliance</strong></td>
                            <td>Complex implementation</td>
                            <td>Built-in compliance</td>
                        </tr>
                        <tr>
                            <td><strong>Scalability</strong></td>
                            <td>Custom scaling logic</td>
                            <td>Auto-scaling</td>
                        </tr>
                        <tr>
                            <td><strong>Social Logins</strong></td>
                            <td>Multiple integrations</td>
                            <td>50+ providers out-of-box</td>
                        </tr>
                        <tr>
                            <td><strong>MFA Support</strong></td>
                            <td>Custom implementation</td>
                            <td>SMS, Email, TOTP, Push</td>
                        </tr>
                    </tbody>
                </table>

                <h3>üåê GCP Integration Advantages</h3>
                <ul>
                    <li><strong>Seamless Cloud Run Integration:</strong> Easy deployment with environment variables and secret management</li>
                    <li><strong>Cloud Functions Support:</strong> Serverless authentication for event-driven architectures</li>
                    <li><strong>IAM Integration:</strong> Map Auth0 roles to GCP IAM permissions</li>
                    <li><strong>Global Load Balancer:</strong> Distribute authenticated traffic across regions</li>
                    <li><strong>Cloud CDN:</strong> Cache Auth0 tokens and user data at edge locations</li>
                    <li><strong>Monitoring & Logging:</strong> Integrate with Cloud Monitoring and Cloud Logging</li>
                </ul>

                <h2>Step-by-Step: Auth0 Integration in Python on GCP</h2>
                <div class="checklist">
                    <ul>
                        <li>‚úÖ Create an Auth0 tenant and configure application settings</li>
                        <li>‚úÖ Set up allowed callback/logout URLs for your GCP deployment</li>
                        <li>‚úÖ Install Auth0 Python SDK and configure dependencies</li>
                        <li>‚úÖ Implement authentication middleware and protected routes</li>
                        <li>‚úÖ Configure environment variables and secrets management</li>
                        <li>‚úÖ Deploy securely on Google Cloud with best practices</li>
                        <li>‚úÖ Set up monitoring, logging, and error handling</li>
                    </ul>
                </div>

                <h3>1. Create and Configure Auth0 Application</h3>
                <div class="best-practices">
                    <h4>üìã Detailed Setup Steps</h4>
                    <ol>
                        <li><strong>Create Account:</strong> Sign up at <a href="https://auth0.com/" target="_blank">Auth0 Dashboard</a></li>
                        <li><strong>Create Application:</strong> Choose "Regular Web Application" for server-side Python apps</li>
                        <li><strong>Configure Settings:</strong>
                            <ul>
                                <li><strong>Allowed Callback URLs:</strong> <code>https://your-app.a.run.app/callback, http://localhost:8080/callback</code></li>
                                <li><strong>Allowed Logout URLs:</strong> <code>https://your-app.a.run.app/, http://localhost:8080/</code></li>
                                <li><strong>Allowed Web Origins:</strong> <code>https://your-app.a.run.app, http://localhost:8080</code></li>
                            </ul>
                        </li>
                        <li><strong>Enable Connections:</strong> Database, Google, GitHub, LinkedIn, etc.</li>
                        <li><strong>Configure Rules/Actions:</strong> Add custom claims, roles, or user metadata</li>
                    </ol>
                </div>

                <h3>2. Python Dependencies and Setup</h3>
                <div class="code-block">
                    <pre><code># requirements.txt
flask==3.0.0
python-dotenv==1.0.0
authlib==1.3.0
gunicorn==21.2.0
requests==2.31.0

# For enhanced security
flask-talisman==1.1.0  # HTTPS enforcement
flask-limiter==3.5.0   # Rate limiting
cryptography==41.0.8   # JWT validation</code></pre>
                </div>

                <h3>3. Production-Ready Flask App with Auth0</h3>
                <div class="info-box">
                    <strong>üöÄ Enterprise-Ready Implementation:</strong> This example includes error handling, logging, security headers, and is optimized for Cloud Run deployment.
                </div>

                <!-- Interactive Code Editor -->
                <div class="interactive-code">
                    <h4>üß™ Interactive Auth0 Integration Demo</h4>
                    <p>Edit and run the code below to understand Auth0's authentication flow:</p>
                    
                    <div class="code-editor" id="pythonEditor"></div>
                    <button class="run-button" onclick="runPython()" id="runBtn">Run Demo</button>
                    <div class="output" id="output">Click "Run Demo" to see Auth0 authentication flow simulation...</div>
                </div>

                <h3>4. Environment Variables & Security Configuration</h3>
                <div class="code-block">
<pre><code># .env (Local Development)
AUTH0_CLIENT_ID=your_auth0_client_id
AUTH0_CLIENT_SECRET=your_auth0_client_secret
AUTH0_DOMAIN=your-tenant-region.auth0.com
AUTH0_AUDIENCE=https://your-api-identifier
AUTH0_CALLBACK_URL=http://localhost:8080/callback
APP_SECRET_KEY=your_super_secret_key_min_32_chars
FLASK_ENV=development

# Production on GCP (use Secret Manager)
AUTH0_CALLBACK_URL=https://your-app-xyz.a.run.app/callback
FLASK_ENV=production</code></pre>
                </div>

                <div class="warning-box">
                    <strong>üîí Security Best Practice:</strong> Never commit secrets to version control. Use GCP Secret Manager for production deployments.
                </div>

                <h3>5. Advanced GCP Deployment with Security</h3>
                
                <h4>Dockerfile (Multi-stage for Security)</h4>
                <div class="code-block">
<pre><code class="language-dockerfile"># Multi-stage build for security and smaller image size
FROM python:3.11-slim as builder
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir --user -r requirements.txt

FROM python:3.11-slim
WORKDIR /app

# Create non-root user
RUN groupadd -r appuser && useradd -r -g appuser appuser

# Copy dependencies and app
COPY --from=builder /root/.local /home/appuser/.local
COPY . .

# Set PATH and ownership
ENV PATH=/home/appuser/.local/bin:$PATH
RUN chown -R appuser:appuser /app
USER appuser

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8080/health || exit 1

EXPOSE 8080
CMD ["gunicorn", "-b", "0.0.0.0:8080", "--workers", "2", "--timeout", "120", "app:app"]</code></pre>
                </div>

                <h4>Cloud Run Deployment with Secret Manager</h4>
                <div class="code-block">
<pre><code># 1. Store secrets in Secret Manager
gcloud secrets create auth0-client-secret --data-file=client_secret.txt
gcloud secrets create app-secret-key --data-file=app_secret.txt

# 2. Build and push container
gcloud builds submit --tag gcr.io/YOUR_PROJECT_ID/auth0-flask-app

# 3. Deploy to Cloud Run with secrets
gcloud run deploy auth0-flask-app \
  --image gcr.io/YOUR_PROJECT_ID/auth0-flask-app \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated \
  --memory 1Gi \
  --cpu 1 \
  --concurrency 100 \
  --max-instances 10 \
  --set-env-vars AUTH0_CLIENT_ID=your_client_id \
  --set-env-vars AUTH0_DOMAIN=your-tenant.auth0.com \
  --set-env-vars AUTH0_CALLBACK_URL=https://your-app-xyz.a.run.app/callback \
  --set-secrets AUTH0_CLIENT_SECRET=auth0-client-secret:latest \
  --set-secrets APP_SECRET_KEY=app-secret-key:latest

# 4. Configure custom domain (optional)
gcloud run domain-mappings create --service auth0-flask-app --domain your-domain.com</code></pre>
                </div>

                <h2>üõ°Ô∏è Security Best Practices</h2>
                
                <div class="best-practices">
                    <h4>üîê Authentication Security</h4>
                    <ul>
                        <li><strong>Token Validation:</strong> Always validate JWT signatures and claims (issuer, audience, expiration)</li>
                        <li><strong>HTTPS Everywhere:</strong> Enforce HTTPS for all Auth0 callbacks and API endpoints</li>
                        <li><strong>Secure Session Storage:</strong> Use secure, httpOnly cookies with proper SameSite attributes</li>
                        <li><strong>Token Refresh:</strong> Implement proper token refresh logic for long-lived sessions</li>
                        <li><strong>Logout Security:</strong> Clear all session data and invalidate tokens on logout</li>
                    </ul>
                </div>

                <div class="best-practices">
                    <h4>üèóÔ∏è Application Security</h4>
                    <ul>
                        <li><strong>Rate Limiting:</strong> Implement rate limiting on auth endpoints to prevent abuse</li>
                        <li><strong>CSRF Protection:</strong> Use state parameters in OAuth flows to prevent CSRF attacks</li>
                        <li><strong>Input Validation:</strong> Validate all user inputs and API responses</li>
                        <li><strong>Security Headers:</strong> Implement HSTS, CSP, and other security headers</li>
                        <li><strong>Error Handling:</strong> Don't expose sensitive information in error messages</li>
                    </ul>
                </div>

                <div class="best-practices">
                    <h4>‚òÅÔ∏è GCP-Specific Security</h4>
                    <ul>
                        <li><strong>IAM Integration:</strong> Map Auth0 roles to GCP IAM permissions for fine-grained access control</li>
                        <li><strong>VPC Security:</strong> Deploy in private VPC with proper firewall rules</li>
                        <li><strong>Secret Management:</strong> Use GCP Secret Manager, never hardcode secrets</li>
                        <li><strong>Audit Logging:</strong> Enable Cloud Audit Logs for all authentication events</li>
                        <li><strong>Monitoring:</strong> Set up alerts for suspicious authentication patterns</li>
                    </ul>
                </div>

                <h2>üîß Advanced Auth0 Features</h2>

                <h3>Role-Based Access Control (RBAC)</h3>
                <div class="code-block">
<pre><code># Auth0 Rule/Action to add roles to tokens
function addRolesToTokens(user, context, callback) {
  const assignedRoles = (context.authorization || {}).roles;
  const idTokenClaims = context.idToken || {};
  const accessTokenClaims = context.accessToken || {};
  
  idTokenClaims['https://yourapp.com/roles'] = assignedRoles;
  accessTokenClaims['https://yourapp.com/roles'] = assignedRoles;
  
  context.idToken = idTokenClaims;
  context.accessToken = accessTokenClaims;
  
  callback(null, user, context);
}</code></pre>
                </div>

                <h3>Multi-Factor Authentication (MFA)</h3>
                <div class="success-box">
                    <strong>üîí MFA Options in Auth0:</strong>
                    <ul>
                        <li><strong>SMS:</strong> Text message verification codes</li>
                        <li><strong>Email:</strong> Email-based verification codes</li>
                        <li><strong>TOTP:</strong> Time-based one-time passwords (Google Authenticator, Authy)</li>
                        <li><strong>Push Notifications:</strong> Auth0 Guardian app notifications</li>
                        <li><strong>WebAuthn:</strong> Hardware keys and biometric authentication</li>
                    </ul>
                </div>

                <h2>üö® Monitoring and Troubleshooting</h2>

                <h3>Essential Monitoring Metrics</h3>
                <div class="code-block">
<pre><code># Cloud Run monitoring with Auth0 events
import logging
from google.cloud import monitoring_v3

def track_auth_event(event_type, user_id=None, success=True):
    """Track authentication events for monitoring"""
    client = monitoring_v3.MetricServiceClient()
    project_name = f"projects/{PROJECT_ID}"
    
    metric = monitoring_v3.TimeSeries()
    metric.metric.type = f"custom.googleapis.com/auth0/{event_type}"
    metric.metric.labels['success'] = str(success).lower()
    if user_id:
        metric.metric.labels['user_id'] = user_id
    
    # Log for Cloud Logging
    logging.info(f"Auth event: {event_type}, Success: {success}, User: {user_id}")
    
    return metric</code></pre>
                </div>

                <h3>Common Issues and Solutions</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Issue</th>
                            <th>Cause</th>
                            <th>Solution</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Callback URL mismatch</td>
                            <td>URL not registered in Auth0</td>
                            <td>Add exact URL to Allowed Callback URLs</td>
                        </tr>
                        <tr>
                            <td>Token validation failure</td>
                            <td>Wrong audience or issuer</td>
                            <td>Verify JWT claims match Auth0 config</td>
                        </tr>
                        <tr>
                            <td>CORS errors</td>
                            <td>Frontend calling Auth0 directly</td>
                            <td>Use server-side flow, add allowed origins</td>
                        </tr>
                        <tr>
                            <td>Session timeout</td>
                            <td>Short token expiration</td>
                            <td>Implement token refresh mechanism</td>
                        </tr>
                    </tbody>
                </table>

                <h2>üìä Performance Optimization</h2>

                <div class="best-practices">
                    <h4>‚ö° Optimization Strategies</h4>
                    <ul>
                        <li><strong>Token Caching:</strong> Cache valid tokens in Redis/Memorystore to reduce Auth0 API calls</li>
                        <li><strong>Connection Pooling:</strong> Reuse HTTP connections to Auth0 endpoints</li>
                        <li><strong>Async Operations:</strong> Use async/await for non-blocking authentication operations</li>
                        <li><strong>CDN Integration:</strong> Cache Auth0 public keys and configuration via Cloud CDN</li>
                        <li><strong>Regional Deployment:</strong> Deploy closer to your users for reduced latency</li>
                    </ul>
                </div>

                <h2>üîÆ Future-Proofing Your Auth Implementation</h2>

                <div class="info-box">
                    <h4>üöÄ Emerging Trends and Considerations</h4>
                    <ul>
                        <li><strong>Passwordless Authentication:</strong> WebAuthn, magic links, and biometric authentication</li>
                        <li><strong>Zero Trust Architecture:</strong> Continuous authentication and risk-based access control</li>
                        <li><strong>Privacy Regulations:</strong> GDPR, CCPA compliance and data residency requirements</li>
                        <li><strong>Edge Computing:</strong> Authentication at CDN edge for improved performance</li>
                        <li><strong>API-First Architecture:</strong> Microservices authentication with service-to-service tokens</li>
                    </ul>
                </div>

                <h2>üéØ Conclusion</h2>
                <p>
                    Auth0 provides a robust, scalable, and secure authentication solution that integrates seamlessly with Google Cloud Platform. By leveraging Auth0's expertise in identity management and GCP's cloud infrastructure, you can build applications that are both secure and performant.
                </p>
                <p>
                    The combination of Auth0's comprehensive feature set (SSO, MFA, social logins, enterprise connections) with GCP's scalable infrastructure (Cloud Run, Secret Manager, monitoring) creates a powerful foundation for modern applications. Whether you're building a simple web app or a complex microservices architecture, this setup provides the security, scalability, and developer experience needed for production applications.
                </p>

                <div class="success-box">
                    <strong>üéâ Key Takeaways:</strong>
                    <ul>
                        <li>Auth0 handles complex authentication logic, letting you focus on business features</li>
                        <li>GCP provides scalable infrastructure with built-in security and monitoring</li>
                        <li>Python frameworks like Flask integrate easily with both platforms</li>
                        <li>Security best practices are essential for production deployments</li>
                        <li>Monitoring and proper error handling ensure reliable user experiences</li>
                    </ul>
                </div>
            </section>
            <footer class="post-footer">
                <div class="post-nav">
                    <a href="../../blog.html" class="back-to-blog">‚Üê Back to Blog</a>
                </div>
            </footer>
        </article>
    </main>
    <footer>
        <p>&copy; 2025 Deepak Kumar Yadav | <a href="../../index.html">Back to Home</a></p>
    </footer>

    <script>
        // Initialize Mermaid for diagrams
        mermaid.initialize({ startOnLoad: true, theme: 'default' });

        let pyodide;
        let editor;

        // Initialize CodeMirror editor
        document.addEventListener('DOMContentLoaded', async function() {
            // Enhanced Auth0 demo code with more features
            const sampleCode = `# Complete Auth0 Integration Demo
# Demonstrates authentication flow, token handling, and security practices

import json
import time
import hashlib
import secrets
from datetime import datetime, timedelta
from urllib.parse import urlencode

class Auth0Simulator:
    """Simulates Auth0 authentication service"""
    
    def __init__(self, domain, client_id, client_secret):
        self.domain = domain
        self.client_id = client_id
        self.client_secret = client_secret
        self.users = {
            "demo@example.com": {
                "password": "password123",
                "user_id": "auth0|123456789",
                "name": "Demo User",
                "roles": ["user", "admin"],
                "mfa_enabled": True
            },
            "user@company.com": {
                "password": "secure456",
                "user_id": "auth0|987654321", 
                "name": "Company User",
                "roles": ["user"],
                "mfa_enabled": False
            }
        }
    
    def generate_authorization_url(self, redirect_uri, state=None):
        """Generate Auth0 authorization URL"""
        params = {
            "response_type": "code",
            "client_id": self.client_id,
            "redirect_uri": redirect_uri,
            "scope": "openid profile email",
            "state": state or secrets.token_urlsafe(32)
        }
        url = f"https://{self.domain}/authorize?" + urlencode(params)
        return url, params["state"]
    
    def authenticate_user(self, email, password):
        """Simulate user authentication"""
        print(f"üîê Authenticating user: {email}")
        
        user = self.users.get(email)
        if not user or user["password"] != password:
            print("‚ùå Authentication failed: Invalid credentials")
            return None
        
        if user["mfa_enabled"]:
            print("üì± MFA required - sending verification code...")
            time.sleep(0.1)  # Simulate MFA delay
            print("‚úÖ MFA verification successful")
        
        print(f"‚úÖ Authentication successful for {user['name']}")
        return user
    
    def generate_tokens(self, user, client_id):
        """Generate JWT tokens (simplified simulation)"""
        now = datetime.now()
        exp = now + timedelta(hours=24)
        
        # ID Token (user information)
        id_token_payload = {
            "iss": f"https://{self.domain}/",
            "sub": user["user_id"],
            "aud": client_id,
            "exp": int(exp.timestamp()),
            "iat": int(now.timestamp()),
            "email": "demo@example.com",
            "name": user["name"],
            "roles": user["roles"]
        }
        
        # Access Token (for API access)
        access_token_payload = {
            "iss": f"https://{self.domain}/",
            "sub": user["user_id"],
            "aud": f"https://api.yourapp.com",
            "exp": int(exp.timestamp()),
            "iat": int(now.timestamp()),
            "scope": "read:profile write:profile",
            "roles": user["roles"]
        }
        
        return {
            "access_token": f"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.{secrets.token_urlsafe(64)}",
            "id_token": f"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.{secrets.token_urlsafe(64)}",
            "token_type": "Bearer",
            "expires_in": 86400,
            "scope": "openid profile email",
            "id_token_payload": id_token_payload,
            "access_token_payload": access_token_payload
        }

class FlaskAppSimulator:
    """Simulates Flask application with Auth0 integration"""
    
    def __init__(self, auth0_simulator):
        self.auth0 = auth0_simulator
        self.sessions = {}
    
    def login_required(self, func):
        """Decorator to protect routes"""
        def wrapper(*args, **kwargs):
            session_id = kwargs.get('session_id')
            if not session_id or session_id not in self.sessions:
                print("üö´ Access denied: Authentication required")
                return {"error": "Authentication required", "redirect": "/login"}
            
            user_info = self.sessions[session_id]
            print(f"‚úÖ Access granted for {user_info['name']}")
            return func(user_info, *args, **kwargs)
        return wrapper
    
    def require_role(self, required_role):
        """Decorator for role-based access control"""
        def decorator(func):
            def wrapper(user_info, *args, **kwargs):
                if required_role not in user_info.get('roles', []):
                    print(f"üö´ Access denied: Requires '{required_role}' role")
                    return {"error": f"Insufficient permissions. Required role: {required_role}"}
                print(f"‚úÖ Role check passed: User has '{required_role}' role")
                return func(user_info, *args, **kwargs)
            return wrapper
        return decorator
    
    def home(self):
        """Public home page"""
        return {"message": "Welcome! Please login to access protected resources."}
    
    def login(self):
        """Initiate login process"""
        auth_url, state = self.auth0.generate_authorization_url(
            redirect_uri="https://yourapp.com/callback"
        )
        print(f"üîÑ Redirecting to Auth0: {auth_url}")
        return {"redirect_url": auth_url, "state": state}
    
    def callback(self, email, password):
        """Handle Auth0 callback"""
        print("üîÑ Processing Auth0 callback...")
        
        # Simulate authorization code exchange
        user = self.auth0.authenticate_user(email, password)
        if not user:
            return {"error": "Authentication failed"}
        
        # Generate tokens
        tokens = self.auth0.generate_tokens(user, self.auth0.client_id)
        
        # Create session
        session_id = secrets.token_urlsafe(32)
        self.sessions[session_id] = {
            **user,
            "tokens": tokens,
            "login_time": datetime.now().isoformat()
        }
        
        print(f"üé´ Session created: {session_id[:8]}...")
        return {"session_id": session_id, "tokens": tokens}
    
    @login_required
    def dashboard(self, user_info, **kwargs):
        """Protected dashboard"""
        return {
            "message": f"Welcome to your dashboard, {user_info['name']}!",
            "user_info": {
                "name": user_info["name"],
                "roles": user_info["roles"],
                "login_time": user_info["login_time"]
            }
        }
    
    @login_required
    @require_role("admin")
    def admin_panel(self, user_info, **kwargs):
        """Admin-only protected route"""
        return {
            "message": "Admin panel access granted",
            "admin_data": ["user_management", "system_settings", "audit_logs"]
        }

# Initialize Auth0 and Flask simulators
print("üöÄ Auth0 + GCP Python Integration Demo")
print("=" * 50)

auth0 = Auth0Simulator(
    domain="your-tenant.auth0.com",
    client_id="your_client_id_here",
    client_secret="your_client_secret_here"
)

app = FlaskAppSimulator(auth0)

# Demo Flow
print("\\n1Ô∏è‚É£ User visits application home page")
home_response = app.home()
print(f"Response: {home_response['message']}")

print("\\n2Ô∏è‚É£ User clicks login button")
login_response = app.login()
print(f"Auth URL generated: {login_response['redirect_url'][:50]}...")

print("\\n3Ô∏è‚É£ User authenticates with Auth0")
callback_response = app.callback("demo@example.com", "password123")
session_id = callback_response.get("session_id")

if session_id:
    print(f"‚úÖ Login successful! Session ID: {...session_id[:8]}")
    
    print("\\n4Ô∏è‚É£ Accessing protected dashboard")
    dashboard_response = app.dashboard(session_id=session_id)
    print(f"Dashboard: {dashboard_response['message']}")
    print(f"User roles: {dashboard_response['user_info']['roles']}")
    
    print("\\n5Ô∏è‚É£ Attempting admin access")
    admin_response = app.admin_panel(session_id=session_id)
    if "error" not in admin_response:
        print(f"Admin access: {admin_response['message']}")
    else:
        print(f"Admin access denied: {admin_response['error']}")
    
    print("\\n6Ô∏è‚É£ Token Information")
    tokens = callback_response["tokens"]
    console.log(tokens)
    print(f"Access Token: {tokens['access_token'][:30]}...")
    print(f"ID Token: {tokens['id_token'][:30]}...")
    print(f"Token Type: {tokens['token_type']}")
    print(f"Expires In: {tokens['expires_in']} seconds")
    
    print("\\n7Ô∏è‚É£ Security Features Demonstrated")
    print("‚úÖ Secure token generation and validation")
    print("‚úÖ Role-based access control (RBAC)")
    print("‚úÖ Multi-factor authentication (MFA)")
    print("‚úÖ Session management")
    print("‚úÖ Protected route decorators")
    print("‚úÖ JWT token structure")

print("\\nüéâ Demo completed! This shows how Auth0 integrates with Python on GCP")
print("\\nüìö Key Benefits:");
print("  ‚Ä¢ Simplified authentication implementation");
print("  ‚Ä¢ Enterprise-grade security features");
print("  ‚Ä¢ Scalable user management");
print("  ‚Ä¢ Seamless GCP integration");
print("  ‚Ä¢ Compliance with security standards");`;

            editor = CodeMirror(document.getElementById('pythonEditor'), {
                value: sampleCode,
                mode: 'python',
                theme: 'monokai',
                lineNumbers: true,
                autoCloseBrackets: true,
                matchBrackets: true,
                indentUnit: 4,
                lineWrapping: true,
                height: 'auto'
            });

            // Initialize Pyodide
            document.getElementById('output').innerHTML = '<span class="loading">üîÑ Loading Python environment...</span>';
            try {
                pyodide = await loadPyodide();
                document.getElementById('output').innerHTML = '‚úÖ Python environment ready! Click "Run Demo" to see the complete Auth0 integration flow.';
            } catch (error) {
                document.getElementById('output').innerHTML = '<span class="error">‚ùå Error loading Python environment: ' + error.message + '</span>';
            }
        });

        async function runPython() {
            const runBtn = document.getElementById('runBtn');
            const output = document.getElementById('output');
            
            if (!pyodide) {
                output.innerHTML = '<span class="error">‚ùå Python environment not loaded yet. Please wait and try again.</span>';
                return;
            }

            runBtn.disabled = true;
            runBtn.textContent = 'Running Demo...';
            output.innerHTML = '<span class="loading">üîÑ Executing Auth0 integration demo...</span>';

            try {
                const code = editor.getValue();
                
                // Capture stdout
                pyodide.runPython(`
import sys
from io import StringIO
sys.stdout = StringIO()
                `);
                
                // Run the user's code
                pyodide.runPython(code);
                
                // Get the output
                const stdout = pyodide.runPython("sys.stdout.getvalue()");
                
                output.innerHTML = stdout || '<span class="success">‚úÖ Demo executed successfully (no output)</span>';
            } catch (error) {
                output.innerHTML = '<span class="error">‚ùå Error: ' + error.message + '</span>';
            }

            runBtn.disabled = false;
            runBtn.textContent = 'Run Demo';
        }
    </script>
</body>
</html>